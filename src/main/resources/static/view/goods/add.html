<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>企业进销存系统</title>
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <script src="../../layui/layui.all.js"></script>
    <script src="../../module/common.js"></script>
</head>
<body>
<div class="layui-fluid" style="padding: 10px">

    <form class="layui-form" id="add_unit">
        <div class="layui-form-item">
            <label class="layui-form-label">编码</label>
            <div class="layui-input-block">
                <input id="number" type="text" name="name" required="" lay-verify="required" placeholder="请输入商品编码"
                       autocomplete="off" class="layui-input"/>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">名称</label>
            <div class="layui-input-block">
                <input id="name" type="text" name="name" required="" lay-verify="required" placeholder="请输入商品名称"
                       autocomplete="off" class="layui-input"/>
            </div>
        </div>
        <div class="layui-form-item">
            <label for="" class="layui-form-label">商品类型</label>
            <input class="layui-hide" id="typeId">
            <div class="layui-input-block">
                <input type="text" id="tree" lay-filter="tree" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">主单位</label>
<!--            <input class="layui-hide" id="majorUnitId">-->
            <div class="layui-input-block">
                <select id="majorUnitId" name="majorUnit" lay-filter="majorUnit"></select>
            </div>
        </div>
        <hr/>
    </form>

</div>
</body>
<script type="text/javascript">
    layui.use(['form', 'treeSelect', 'jquery'], function () {
        var form = layui.form;
        var treeSelect = layui.treeSelect;
        var $ = layui.jquery;
        var unitList;

        $.ajax({
            url: "/store/unit/all",
            type: "get",
            success: function (data) {
                if (data.success) {
                    unitList = data.data.all;
                    // $('#majorUnitId').val(unitList[0].id);
                    $.each(unitList, function (index, item) {
                        console.log(item);
                        //option  第一个参数是页面显示的值，第二个参数是传递到后台的值
                        $('#majorUnitId').append(new Option(item.name, item.id));//往下拉菜单里添加元素
                        //设置value（这个值就可以是在更新的时候后台传递到前台的值）为2的值为默认选中
                    })
                    form.render('select');
                } else {

                }
            }
        })

        form.render();

        treeSelect.render({
            // 选择器
            elem: '#tree',
            // 数据
            data: '/store/goodsType/all',
            // 异步加载方式：get/post，默认get
            type: 'get',
            // 占位符
            placeholder: '选择商品类型',
            // 是否开启搜索功能：true/false，默认false
            search: true,
            // 点击回调
            click: function (obj) {
                var local_data = obj.current;
                if (!local_data.leaf) {
                    treeSelect.revokeNode('tree', function (d) {
                        console.log(d);
                        console.log(d.treeId);
                    });
                    layer.msg("商品类型必须为叶子节点类型");
                } else {
                    var typeId = local_data.id;
                    $('#typeId').val(typeId);
                }
            },
            // 加载完成后的回调函数
            success: function (d) {
//                选中节点，根据id筛选


//                获取zTree对象，可以调用zTree方法
//                var treeObj = treeSelect.zTree('tree');
//                console.log(treeObj);

//                刷新树结构
//                treeSelect.refresh();
            }
        });


    });
</script>


</html>